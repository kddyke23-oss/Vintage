<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vintage at Hamilton - Community Directory</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
  :root { --primary: #2c5f2d; --primary-light: #4a8c4b; --primary-dark: #1a3d1b; --accent: #c9a94e; --accent-light: #e8d590; --bg: #f5f1eb; --card-bg: #ffffff; --text: #2d2d2d; --text-light: #6b6b6b; --border: #d4cfc6; --danger: #c0392b; --danger-light: #e74c3c; --success: #27ae60; --tag-bg: #eaf2ea; --tag-text: #2c5f2d; }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
  .header { background: linear-gradient(135deg, var(--primary-dark), var(--primary)); color: white; padding: 1.5rem 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.15); position: sticky; top: 0; z-index: 100; }
  .header-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
  .header h1 { font-size: 1.6rem; font-weight: 700; letter-spacing: 0.5px; }
  .header h1 span { color: var(--accent-light); font-weight: 400; font-size: 0.9rem; display: block; margin-top: 2px; }
  .header-actions { display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; }
  .btn { padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.2s; display: inline-flex; align-items: center; gap: 0.4rem; }
  .btn-primary { background: var(--accent); color: var(--primary-dark); } .btn-primary:hover { background: var(--accent-light); }
  .btn-secondary { background: rgba(255,255,255,0.15); color: white; border: 1px solid rgba(255,255,255,0.3); } .btn-secondary:hover { background: rgba(255,255,255,0.25); }
  .btn-danger { background: var(--danger); color: white; } .btn-danger:hover { background: var(--danger-light); }
  .btn-success { background: var(--success); color: white; } .btn-success:hover { background: #2ecc71; }
  .btn-sm { padding: 0.3rem 0.6rem; font-size: 0.8rem; }
  .btn-outline { background: transparent; color: var(--primary); border: 1px solid var(--primary); } .btn-outline:hover { background: var(--primary); color: white; }
  .container { max-width: 1200px; margin: 0 auto; padding: 1.5rem; }
  .login-container { display: flex; justify-content: center; align-items: center; min-height: 80vh; padding: 2rem; }
  .login-card { background: var(--card-bg); border-radius: 12px; padding: 3rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 420px; width: 100%; text-align: center; }
  .login-card h2 { color: var(--primary); margin-bottom: 0.5rem; font-size: 1.8rem; }
  .login-card p { color: var(--text-light); margin-bottom: 2rem; }
  .login-card .logo { font-size: 3rem; margin-bottom: 1rem; }
  .form-group { margin-bottom: 1rem; text-align: left; }
  .form-group label { display: block; font-weight: 600; margin-bottom: 0.3rem; font-size: 0.875rem; color: var(--text); }
  .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.6rem 0.8rem; border: 1px solid var(--border); border-radius: 6px; font-size: 0.95rem; transition: border-color 0.2s; background: white; }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(44,95,45,0.1); }
  .error-msg { color: var(--danger); font-size: 0.85rem; margin-top: 0.5rem; }
  .search-bar { background: var(--card-bg); border-radius: 10px; padding: 1rem 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap; }
  .search-bar input { flex: 1; min-width: 200px; padding: 0.6rem 1rem; border: 1px solid var(--border); border-radius: 6px; font-size: 0.95rem; }
  .search-bar input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(44,95,45,0.1); }
  .search-bar select { padding: 0.6rem 0.8rem; border: 1px solid var(--border); border-radius: 6px; font-size: 0.875rem; background: white; }
  .stats { font-size: 0.85rem; color: var(--text-light); margin-left: auto; white-space: nowrap; }
  .directory-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 1rem; }
  .resident-card { background: var(--card-bg); border-radius: 10px; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); transition: box-shadow 0.2s, transform 0.2s; border-left: 4px solid var(--primary); }
  .resident-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.1); transform: translateY(-1px); }
  .resident-card .name { font-size: 1.15rem; font-weight: 700; color: var(--primary-dark); margin-bottom: 0.2rem; }
  .resident-card .names-sub { font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.75rem; }
  .resident-card .detail { font-size: 0.875rem; color: var(--text); margin-bottom: 0.35rem; display: flex; align-items: flex-start; gap: 0.5rem; }
  .resident-card .detail .icon { flex-shrink: 0; width: 18px; text-align: center; color: var(--primary); }
  .resident-card .detail .value { word-break: break-word; }
  .tags-container { display: flex; flex-wrap: wrap; gap: 0.3rem; margin-top: 0.6rem; }
  .tag { display: inline-block; background: var(--tag-bg); color: var(--tag-text); padding: 0.15rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500; }
  .card-actions { display: flex; gap: 0.4rem; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border); }
  .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 200; padding: 1rem; }
  .modal { background: var(--card-bg); border-radius: 12px; padding: 2rem; max-width: 550px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 8px 32px rgba(0,0,0,0.2); }
  .modal h3 { color: var(--primary); margin-bottom: 1.25rem; font-size: 1.3rem; }
  .tag-input-row { display: flex; gap: 0.5rem; align-items: center; } .tag-input-row input { flex: 1; }
  .existing-tags { display: flex; flex-wrap: wrap; gap: 0.3rem; margin-top: 0.5rem; }
  .tag-removable { display: inline-flex; align-items: center; gap: 0.3rem; background: var(--tag-bg); color: var(--tag-text); padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.8rem; }
  .tag-removable button { background: none; border: none; cursor: pointer; color: var(--danger); font-size: 1rem; line-height: 1; padding: 0; }
  .toast { position: fixed; bottom: 2rem; right: 2rem; background: var(--primary); color: white; padding: 0.8rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.2); z-index: 300; animation: slideIn 0.3s ease; font-size: 0.9rem; }
  @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  .admin-badge { background: var(--accent); color: var(--primary-dark); padding: 0.2rem 0.6rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; }
  .filter-tags { display: flex; flex-wrap: wrap; gap: 0.3rem; align-items: center; }
  .filter-tag { padding: 0.25rem 0.6rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer; border: 1px solid var(--border); background: white; transition: all 0.2s; }
  .filter-tag:hover { border-color: var(--primary); } .filter-tag.active { background: var(--primary); color: white; border-color: var(--primary); }
  @media (max-width: 640px) { .header-content { flex-direction: column; align-items: flex-start; } .directory-grid { grid-template-columns: 1fr; } .search-bar { flex-direction: column; } .stats { margin-left: 0; } .modal { padding: 1.5rem; } }

  /* Print Dialog Styles */
  .print-modal { text-align: center; }
  .print-modal h3 { margin-bottom: 0.5rem; }
  .print-modal p { color: var(--text-light); font-size: 0.9rem; margin-bottom: 1.5rem; }
  .print-options { display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1.5rem; }
  .print-option { display: flex; align-items: center; gap: 0.75rem; padding: 1rem; border: 2px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.2s; text-align: left; background: white; }
  .print-option:hover { border-color: var(--primary); background: var(--tag-bg); }
  .print-option.selected { border-color: var(--primary); background: var(--tag-bg); }
  .print-option .print-icon { font-size: 1.5rem; flex-shrink: 0; }
  .print-option .print-label { font-weight: 600; font-size: 0.95rem; color: var(--text); }
  .print-option .print-desc { font-size: 0.8rem; color: var(--text-light); margin-top: 2px; }

  /* Print Styles */
  @media print {
    body { background: white !important; color: black !important; font-size: 11pt; }
    .header, .search-bar, .card-actions, .header-actions, .admin-badge, .toast, .modal-overlay, .no-print { display: none !important; }
    .container { max-width: 100% !important; margin: 0 !important; padding: 0 !important; }
    .print-header { display: block !important; text-align: center; margin-bottom: 12pt; padding-bottom: 8pt; border-bottom: 2pt solid #2c5f2d; }
    .print-header h1 { font-size: 18pt; color: #2c5f2d !important; margin: 0; }
    .print-header p { font-size: 10pt; color: #666 !important; margin: 4pt 0 0 0; }
    .print-table { display: table !important; width: 100%; border-collapse: collapse; font-size: 9pt; }
    .print-table thead { display: table-header-group !important; }
    .print-table th { background: #2c5f2d !important; color: white !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; padding: 6pt 8pt; text-align: left; font-weight: 600; font-size: 9pt; }
    .print-table td { padding: 5pt 8pt; border-bottom: 0.5pt solid #ddd; vertical-align: top; font-size: 9pt; }
    .print-table tr:nth-child(even) td { background: #f5f5f5 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .print-table .name-cell { font-weight: 600; white-space: nowrap; }
    .print-table .names-cell { color: #555; }
    .print-footer { display: block !important; text-align: center; font-size: 8pt; color: #999; margin-top: 12pt; padding-top: 8pt; border-top: 0.5pt solid #ccc; }
    .directory-grid, .resident-card { display: none !important; }
    @page { margin: 0.5in; size: landscape; }
  }
  .print-header, .print-table, .print-footer { display: none; }

  /* Select Mode Styles */
  .select-bar { background: var(--primary); color: white; padding: 0.75rem 1.5rem; border-radius: 10px; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
  .select-bar .select-count { font-weight: 600; font-size: 0.95rem; margin-right: auto; }
  .select-bar .btn { background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); }
  .select-bar .btn:hover { background: rgba(255,255,255,0.35); }
  .select-bar .btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .select-bar .btn-cancel { background: transparent; border: 1px solid rgba(255,255,255,0.4); }
  .resident-card.selectable { cursor: pointer; position: relative; }
  .resident-card.selectable:hover { border-left-color: var(--accent); }
  .resident-card.selected { border-left-color: var(--accent); background: #fdfcf5; box-shadow: 0 0 0 2px var(--accent); }
  .select-checkbox { position: absolute; top: 0.75rem; right: 0.75rem; width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 4px; background: white; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
  .select-checkbox.checked { background: var(--primary); border-color: var(--primary); color: white; font-size: 0.8rem; }
  @media print { .select-bar, .select-checkbox { display: none !important; } }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useMemo, useCallback } = React;

// Password hashes (SHA-256) - actual passwords cannot be read from source
const VIEWER_HASH = "b6d37b2f37626a083fcae5694269a9d59e03adc35cb1c9db4bd66f86108df80d";
const ADMIN_HASH = "8138379a995e95d09473cf2e29a02dff82f9293ae954a847942666b5856d35ae";

// SHA-256 hash function using Web Crypto API
async function sha256(message) {
  const msgBuffer = new TextEncoder().encode(message);
  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

function App() {
  const [auth, setAuth] = useState(null);
  const [data, setData] = useState([]);
  const [search, setSearch] = useState("");
  const [searchField, setSearchField] = useState("all");
  const [tagFilter, setTagFilter] = useState("");
  const [editingEntry, setEditingEntry] = useState(null);
  const [showAddModal, setShowAddModal] = useState(false);
  const [toast, setToast] = useState(null);
  const [passwordInput, setPasswordInput] = useState("");
  const [loginError, setLoginError] = useState("");
  const [isChecking, setIsChecking] = useState(false);
  const [showPrintModal, setShowPrintModal] = useState(false);
  const [printMode, setPrintMode] = useState(null);
  const [selectMode, setSelectMode] = useState(false);
  const [selectedIds, setSelectedIds] = useState(new Set());

  useEffect(() => {
    fetch("data.json").then(r => r.json()).then(d => setData(d)).catch(() => { console.log("Could not load data.json"); });
  }, []);

  const showToast = useCallback((msg) => { setToast(msg); setTimeout(() => setToast(null), 3000); }, []);

  const allTags = useMemo(() => {
    const tags = new Set();
    data.forEach(entry => entry.tags && entry.tags.forEach(t => tags.add(t)));
    return Array.from(tags).sort();
  }, [data]);

  const filteredData = useMemo(() => {
    let result = data;
    if (tagFilter) { result = result.filter(e => e.tags && e.tags.includes(tagFilter)); }
    if (search.trim()) {
      const q = search.toLowerCase().trim();
      result = result.filter(entry => {
        if (searchField === "name" || searchField === "all") { if ((entry.surname + " " + entry.names).toLowerCase().includes(q)) return true; }
        if (searchField === "address" || searchField === "all") { if (entry.address.toLowerCase().includes(q)) return true; }
        if (searchField === "tag" || searchField === "all") { if (entry.tags && entry.tags.some(t => t.toLowerCase().includes(q))) return true; }
        return false;
      });
    }
    return result.sort((a, b) => a.surname.localeCompare(b.surname));
  }, [data, search, searchField, tagFilter]);

  const handleLogin = async (e) => {
    e.preventDefault();
    setIsChecking(true);
    try {
      const hash = await sha256(passwordInput);
      if (hash === ADMIN_HASH) { setAuth("admin"); setLoginError(""); }
      else if (hash === VIEWER_HASH) { setAuth("viewer"); setLoginError(""); }
      else { setLoginError("Incorrect password. Please try again."); }
    } catch (err) { setLoginError("Error verifying password."); }
    setPasswordInput("");
    setIsChecking(false);
  };

  const handleLogout = () => { setAuth(null); setSearch(""); setTagFilter(""); };

  const handleSaveEntry = (entry) => {
    const newData = data.map(e => e.id === entry.id ? entry : e);
    setData(newData); setEditingEntry(null); showToast("Entry updated successfully");
  };

  const handleAddEntry = (entry) => {
    const maxId = data.reduce((max, e) => Math.max(max, e.id), 0);
    setData([...data, { ...entry, id: maxId + 1 }]); setShowAddModal(false); showToast("New entry added successfully");
  };

  const handleDeleteEntry = (id) => {
    if (confirm("Are you sure you want to remove this entry?")) { setData(data.filter(e => e.id !== id)); showToast("Entry removed"); }
  };

  const handleExportData = () => {
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "data.json"; a.click(); URL.revokeObjectURL(url);
    showToast("Data exported as data.json");
  };

  const handlePrint = (mode) => {
    setPrintMode(mode);
    setShowPrintModal(false);
  };

  const printData = useMemo(() => {
    if (printMode === 'filtered') return filteredData;
    if (printMode === 'all') return [...data].sort((a, b) => a.surname.localeCompare(b.surname));
    return [];
  }, [printMode, data, filteredData]);

  useEffect(() => {
    if (printMode && printData.length > 0) {
      const timer = setTimeout(() => { window.print(); setPrintMode(null); }, 150);
      return () => clearTimeout(timer);
    }
  }, [printMode, printData]);

  const toggleSelectMode = () => { setSelectMode(!selectMode); setSelectedIds(new Set()); };
  const toggleSelect = (id) => { setSelectedIds(prev => { const next = new Set(prev); if (next.has(id)) next.delete(id); else next.add(id); return next; }); };
  const selectAll = () => { setSelectedIds(new Set(filteredData.map(e => e.id))); };
  const selectNone = () => { setSelectedIds(new Set()); };

  const handleEmailSelected = () => {
    const emails = data.filter(e => selectedIds.has(e.id)).flatMap(e => e.emails || []).filter(Boolean);
    if (emails.length === 0) { showToast("No email addresses for selected residents"); return; }
    const unique = [...new Set(emails)];
    window.location.href = "mailto:" + unique.join(",");
    showToast("Opening email for " + unique.length + " address" + (unique.length !== 1 ? "es" : ""));
  };

  const handleCopyPhones = () => {
    const phones = data.filter(e => selectedIds.has(e.id)).flatMap(e => e.phones || []).filter(Boolean);
    if (phones.length === 0) { showToast("No phone numbers for selected residents"); return; }
    const unique = [...new Set(phones)];
    navigator.clipboard.writeText(unique.join("\n")).then(() => showToast("Copied " + unique.length + " phone number" + (unique.length !== 1 ? "s" : "") + " to clipboard")).catch(() => showToast("Could not copy to clipboard"));
  };

  const handleCopyEmails = () => {
    const emails = data.filter(e => selectedIds.has(e.id)).flatMap(e => e.emails || []).filter(Boolean);
    if (emails.length === 0) { showToast("No email addresses for selected residents"); return; }
    const unique = [...new Set(emails)];
    navigator.clipboard.writeText(unique.join("\n")).then(() => showToast("Copied " + unique.length + " email" + (unique.length !== 1 ? "s" : "") + " to clipboard")).catch(() => showToast("Could not copy to clipboard"));
  };

  if (!auth) {
    return (
      <div>
        <div className="header"><div className="header-content"><h1>Vintage at Hamilton<span>Community Directory</span></h1></div></div>
        <div className="login-container">
          <div className="login-card">
            <div className="logo">{"\u{1F3E1}"}</div>
            <h2>Welcome</h2>
            <p>Enter the community password to access the directory.</p>
            <form onSubmit={handleLogin}>
              <div className="form-group">
                <input type="password" placeholder="Enter password" value={passwordInput} onChange={e => setPasswordInput(e.target.value)} autoFocus disabled={isChecking} />
              </div>
              {loginError && <p className="error-msg">{loginError}</p>}
              <button type="submit" className="btn btn-primary" style={{width:'100%', padding:'0.7rem', fontSize:'1rem', marginTop:'0.5rem'}} disabled={isChecking}>
                {isChecking ? "Verifying..." : "Sign In"}
              </button>
            </form>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div>
      <div className="header">
        <div className="header-content">
          <h1>Vintage at Hamilton<span>Community Directory &mdash; {data.length} Households</span></h1>
          <div className="header-actions">
            {auth === "admin" && <span className="admin-badge">ADMIN</span>}
            {auth === "admin" && (<><button className="btn btn-primary" onClick={() => setShowAddModal(true)}>+ Add Entry</button><button className="btn btn-secondary" onClick={handleExportData}>Export JSON</button></>)}
            <button className="btn btn-secondary" onClick={() => setShowPrintModal(true)}>{"\u{1F5A8}\u{FE0F}"} Print</button>
            <button className={"btn " + (selectMode ? "btn-primary" : "btn-secondary")} onClick={toggleSelectMode}>{selectMode ? "Exit Select" : "\u{2709}\u{FE0F} Select"}</button>
            <button className="btn btn-secondary" onClick={handleLogout}>Sign Out</button>
          </div>
        </div>
      </div>
      <div className="container">
        <div className="search-bar">
          <input type="text" placeholder="Search residents..." value={search} onChange={e => setSearch(e.target.value)} />
          <select value={searchField} onChange={e => setSearchField(e.target.value)}>
            <option value="all">All Fields</option><option value="name">Name</option><option value="address">Address</option><option value="tag">Tag / Role</option>
          </select>
          {allTags.length > 0 && (
            <div className="filter-tags">
              <span style={{fontSize:'0.8rem',color:'var(--text-light)',marginRight:'0.3rem'}}>Tags:</span>
              {allTags.map(tag => (<span key={tag} className={"filter-tag " + (tagFilter === tag ? "active" : "")} onClick={() => setTagFilter(tagFilter === tag ? "" : tag)}>{tag}</span>))}
              {tagFilter && (<span className="filter-tag" onClick={() => setTagFilter("")} style={{color:'var(--danger)'}}>Clear</span>)}
            </div>
          )}
          <span className="stats">Showing {filteredData.length} of {data.length}</span>
        </div>
        {selectMode && (
          <div className="select-bar">
            <span className="select-count">{selectedIds.size} selected</span>
            <button className="btn btn-sm" onClick={selectAll}>Select All</button>
            <button className="btn btn-sm" onClick={selectNone}>Clear</button>
            <button className="btn btn-sm" onClick={handleEmailSelected} disabled={selectedIds.size === 0}>{"\u{2709}\u{FE0F}"} Email</button>
            <button className="btn btn-sm" onClick={handleCopyEmails} disabled={selectedIds.size === 0}>{"\u{1F4CB}"} Copy Emails</button>
            <button className="btn btn-sm" onClick={handleCopyPhones} disabled={selectedIds.size === 0}>{"\u{1F4DE}"} Copy Phones</button>
            <button className="btn btn-sm btn-cancel" onClick={toggleSelectMode}>Done</button>
          </div>
        )}
        <div className="directory-grid">
          {filteredData.map(entry => (<ResidentCard key={entry.id} entry={entry} auth={auth} onEdit={() => setEditingEntry({...entry})} onDelete={() => handleDeleteEntry(entry.id)} selectMode={selectMode} selected={selectedIds.has(entry.id)} onToggleSelect={() => toggleSelect(entry.id)} />))}
          {filteredData.length === 0 && (<div style={{gridColumn:'1/-1',textAlign:'center',padding:'3rem',color:'var(--text-light)'}}>No residents found matching your search.</div>)}
        </div>
      </div>
      {editingEntry && (<EntryModal entry={editingEntry} onSave={handleSaveEntry} onClose={() => setEditingEntry(null)} title="Edit Entry" />)}
      {showAddModal && (<EntryModal entry={{id:0, surname:"", names:"", address:"", phones:[""], emails:[""], tags:[]}} onSave={handleAddEntry} onClose={() => setShowAddModal(false)} title="Add New Entry" />)}
      {showPrintModal && (
        <div className="modal-overlay" onClick={() => setShowPrintModal(false)}>
          <div className="modal print-modal" onClick={e => e.stopPropagation()}>
            <h3>{"\u{1F5A8}\u{FE0F}"} Print Directory</h3>
            <p>Choose what to print:</p>
            <div className="print-options">
              <div className="print-option" onClick={() => handlePrint('all')}>
                <span className="print-icon">{"\u{1F4CB}"}</span>
                <div>
                  <div className="print-label">Full Directory</div>
                  <div className="print-desc">Print all {data.length} households</div>
                </div>
              </div>
              <div className="print-option" onClick={() => handlePrint('filtered')}>
                <span className="print-icon">{"\u{1F50D}"}</span>
                <div>
                  <div className="print-label">Current View</div>
                  <div className="print-desc">Print {filteredData.length} household{filteredData.length !== 1 ? 's' : ''} matching your current search/filter</div>
                </div>
              </div>
            </div>
            <button className="btn btn-secondary" onClick={() => setShowPrintModal(false)} style={{color:'var(--text)',background:'var(--bg)',width:'100%'}}>Cancel</button>
          </div>
        </div>
      )}
      {printMode && (
        <div>
          <div className="print-header">
            <h1>Vintage at Hamilton &mdash; Community Directory</h1>
            <p>{printMode === 'filtered' && (search || tagFilter) ? 'Filtered: ' + [search && ('Search: "' + search + '"'), tagFilter && ('Tag: ' + tagFilter)].filter(Boolean).join(', ') + ' \u2014 ' : ''}{printData.length} Household{printData.length !== 1 ? 's' : ''} &bull; Printed {new Date().toLocaleDateString('en-US', {month:'long', day:'numeric', year:'numeric'})}</p>
          </div>
          <table className="print-table">
            <thead><tr><th>Surname</th><th>Names</th><th>Address</th><th>Phone(s)</th><th>Email(s)</th></tr></thead>
            <tbody>
              {printData.map(entry => (
                <tr key={entry.id}>
                  <td className="name-cell">{entry.surname}</td>
                  <td className="names-cell">{entry.names}</td>
                  <td>{entry.address}</td>
                  <td>{entry.phones ? entry.phones.join(', ') : ''}</td>
                  <td>{entry.emails ? entry.emails.join(', ') : ''}</td>
                </tr>
              ))}
            </tbody>
          </table>
          <div className="print-footer">Vintage at Hamilton Community Directory &bull; Confidential &mdash; For Resident Use Only</div>
        </div>
      )}
      {toast && <div className="toast">{toast}</div>}
    </div>
  );
}

function ResidentCard({ entry, auth, onEdit, onDelete, selectMode, selected, onToggleSelect }) {
  const cardClass = "resident-card" + (selectMode ? " selectable" : "") + (selected ? " selected" : "");
  const handleClick = () => { if (selectMode) onToggleSelect(); };
  return (
    <div className={cardClass} onClick={handleClick}>
      {selectMode && <div className={"select-checkbox" + (selected ? " checked" : "")}>{selected ? "\u2713" : ""}</div>}
      <div className="name">{entry.surname}</div>
      <div className="names-sub">{entry.names}</div>
      <div className="detail"><span className="icon">{"\u{1F4CD}"}</span><span className="value">{entry.address}</span></div>
      {entry.phones && entry.phones.length > 0 && (<div className="detail"><span className="icon">{"\u{1F4DE}"}</span><span className="value">{entry.phones.join(" / ")}</span></div>)}
      {entry.emails && entry.emails.length > 0 && (<div className="detail"><span className="icon">{"\u{2709}\u{FE0F}"}</span><span className="value">{entry.emails.map((em, i) => (<span key={i}><a href={"mailto:"+em} style={{color:'var(--primary)',textDecoration:'none'}}>{em}</a>{i < entry.emails.length - 1 ? " / " : ""}</span>))}</span></div>)}
      {entry.tags && entry.tags.length > 0 && (<div className="tags-container">{entry.tags.map((tag, i) => (<span key={i} className="tag">{tag}</span>))}</div>)}
      {auth === "admin" && (<div className="card-actions"><button className="btn btn-outline btn-sm" onClick={onEdit}>Edit</button><button className="btn btn-danger btn-sm" onClick={onDelete}>Remove</button></div>)}
    </div>
  );
}

function EntryModal({ entry, onSave, onClose, title }) {
  const [form, setForm] = useState({...entry});
  const [newTag, setNewTag] = useState("");
  const updateField = (field, value) => { setForm(prev => ({...prev, [field]: value})); };
  const updateArrayField = (field, index, value) => { const arr = [...form[field]]; arr[index] = value; setForm(prev => ({...prev, [field]: arr})); };
  const addArrayItem = (field) => { setForm(prev => ({...prev, [field]: [...prev[field], ""]})); };
  const removeArrayItem = (field, index) => { const arr = form[field].filter((_, i) => i !== index); setForm(prev => ({...prev, [field]: arr.length ? arr : [""]})); };
  const addTag = () => { if (newTag.trim() && !form.tags.includes(newTag.trim())) { setForm(prev => ({...prev, tags: [...prev.tags, newTag.trim()]})); setNewTag(""); } };
  const removeTag = (tag) => { setForm(prev => ({...prev, tags: prev.tags.filter(t => t !== tag)})); };
  const handleSubmit = (e) => {
    e.preventDefault();
    if (!form.surname.trim() || !form.names.trim()) { alert("Surname and Names are required."); return; }
    const cleaned = { ...form, phones: form.phones.filter(p => p.trim()), emails: form.emails.filter(e => e.trim()) };
    if (cleaned.phones.length === 0) cleaned.phones = [];
    if (cleaned.emails.length === 0) cleaned.emails = [];
    onSave(cleaned);
  };
  const handleTagKeyDown = (e) => { if (e.key === "Enter") { e.preventDefault(); addTag(); } };

  return (
    <div className="modal-overlay" onClick={onClose}>
      <div className="modal" onClick={e => e.stopPropagation()}>
        <h3>{title}</h3>
        <form onSubmit={handleSubmit}>
          <div className="form-group"><label>Surname *</label><input value={form.surname} onChange={e => updateField('surname', e.target.value.toUpperCase())} required /></div>
          <div className="form-group"><label>First Names *</label><input value={form.names} onChange={e => updateField('names', e.target.value)} required /></div>
          <div className="form-group"><label>Address</label><input value={form.address} onChange={e => updateField('address', e.target.value)} /></div>
          <div className="form-group"><label>Phone Numbers</label>
            {form.phones.map((phone, i) => (<div key={i} style={{display:'flex',gap:'0.3rem',marginBottom:'0.3rem'}}><input value={phone} onChange={e => updateArrayField('phones', i, e.target.value)} placeholder="Phone number" />{form.phones.length > 1 && (<button type="button" className="btn btn-danger btn-sm" onClick={() => removeArrayItem('phones', i)}>-</button>)}</div>))}
            <button type="button" className="btn btn-outline btn-sm" onClick={() => addArrayItem('phones')} style={{marginTop:'0.3rem'}}>+ Phone</button>
          </div>
          <div className="form-group"><label>Email Addresses</label>
            {form.emails.map((email, i) => (<div key={i} style={{display:'flex',gap:'0.3rem',marginBottom:'0.3rem'}}><input value={email} onChange={e => updateArrayField('emails', i, e.target.value)} placeholder="Email address" type="email" />{form.emails.length > 1 && (<button type="button" className="btn btn-danger btn-sm" onClick={() => removeArrayItem('emails', i)}>-</button>)}</div>))}
            <button type="button" className="btn btn-outline btn-sm" onClick={() => addArrayItem('emails')} style={{marginTop:'0.3rem'}}>+ Email</button>
          </div>
          <div className="form-group"><label>Tags / Roles</label>
            <div className="tag-input-row"><input value={newTag} onChange={e => setNewTag(e.target.value)} onKeyDown={handleTagKeyDown} placeholder="e.g. Social Committee" /><button type="button" className="btn btn-outline btn-sm" onClick={addTag}>Add</button></div>
            {form.tags.length > 0 && (<div className="existing-tags">{form.tags.map((tag, i) => (<span key={i} className="tag-removable">{tag}<button type="button" onClick={() => removeTag(tag)}>&times;</button></span>))}</div>)}
          </div>
          <div style={{display:'flex',gap:'0.5rem',marginTop:'1.5rem'}}>
            <button type="submit" className="btn btn-success" style={{flex:1}}>Save</button>
            <button type="button" className="btn btn-secondary" onClick={onClose} style={{flex:1,color:'var(--text)',background:'var(--bg)'}}>Cancel</button>
          </div>
        </form>
      </div>
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById("root"));
</script>
</body>
</html>
